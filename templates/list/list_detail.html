<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ store['name'] }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list_detail.css') }}"> <!-- 외부 CSS 파일 링크 -->
</head>
<body>

    {% include 'navigator.html' %}

    <h1>{{ store['name'] }} / {{ store['food_type'] }}</h1>
    <div class="slider">
        <div class="slides">
            {% for image in images %}
            <div class="slide image_item">
                <img src="{{ url_for('static', filename=image) }}" alt="Image for {{ store['name'] }}">
            </div>
            {% endfor %}
        </div>

        <div class="controls">
            <button class="control" onclick="moveSlide(-1)"> &lt; </button>
            <button class="control" onclick="moveSlide(1)"> &gt; </button>
        </div>
        <div class="store-info">
            <h2>주소 : {{ store['address'] }}</h2>
            <h2>< 대표 메뉴 ></h2>
            <div>
                {% for menu in menus %}
                <div class="menu-item">{{ menu['menu_name'] }} ({{ menu['price'] }}원)</div>
                {% endfor %}
            </div>
            <p>평점 : {{ store['rate'] }}</p>
        </div>
    </div>
    <div>
        <div>
            <h2>새 리뷰 작성하기</h2>
            <form action='/new_review/{{store['store_id']}}' method="POST">
                <div class="mb-3">
                    <label for="exampleFormControlInput1" class="form-label">리뷰</label>
                    <input type="text" name="contents" class="form-control" id="contents" placeholder="가게에 대해서 평가해주세요!">
                </div>
                <div class="mb-3">
                    <label for="exampleFormControlInput1" class="form-label">평점</label>
                    <input type="range" name="rate" min="0" max="5" step="0.5" class="form-control" id="rate">
                </div>
                <div class="mb-3">
                    <label for="exampleFormControlInput1" class="form-label">이미지</label>
                    <input type="file" name="image" class="form-control" id="image">
                </div>
                <input type="submit" value="등록하기"/>
            </form>
        </div>
        <table class="table">
            <thead>
                <th scope="col">리뷰</th>
                <th scope="col">평점</th>
                <th scope="col">이미지</th>
                <th scope="col">수정/삭제</th>
            </thead>
            {% for review in reviews %}
            <tr>
                <td>{{review['contents']}}</td>
                <td>{{review['rate']}}</td>
                <td>{{review['image']}}</td>
                <td>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">수정</button>
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title fs-5" id="exampleModalLabel">리뷰 수정하기</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form action="/update" method="POST">
                                    리뷰 <input type="text" name="contents"/><br>
                                    평점 <input type="range" name="rate" min="0" max="5" step="0.5"/><br>
                                    이미지 <input type="file" name="image"/><br>
                                    <input type="submit" value="수정하기"/>
                                </form>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">창 닫기</button>
                              <button type="submit" class="btn btn-primary">수정하기</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    <form action="/delete" method="GET">
                        <button type="submit" class="btn btn-primary">삭제</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');

        function showSlide(index) {
            if (index < 0) {
                currentSlide = slides.length - 1; // 마지막 슬라이드로 돌아가기
            } else if (index >= slides.length) {
                currentSlide = 0; // 첫 번째 슬라이드로 돌아가기
            } else {
                currentSlide = index;
            }
            const offset = -currentSlide * 100;
            document.querySelector('.slides').style.transform = `translateX(${offset}%)`;
        }

        function moveSlide(direction) {
            showSlide(currentSlide + direction);
        }

        // 첫 번째 슬라이드를 기본으로 보여줍니다.
        showSlide(currentSlide);
        // 페이지가 로드될 때 스크롤을 최상단으로 이동
        window.onload = function() {
                window.scrollTo(0, 0);
            };
    </script>   
</body>
</html>